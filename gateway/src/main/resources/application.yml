# API Gateway Configuration
#
# EDUCATIONAL NOTE - Spring Cloud Gateway
#
# Spring Cloud Gateway uses a reactive programming model (WebFlux).
# Routes are defined declaratively in this YAML file.
#
# Each route has:
# - id: Unique identifier for the route
# - uri: Destination service URL
# - predicates: Conditions to match (e.g., path pattern)
# - filters: Modifications to request/response (optional)

server:
  port: 8080  # Gateway runs on port 8080 (standard HTTP port alt)

spring:
  application:
    name: gateway
  
  cloud:
    gateway:
      routes:
        # Route 1: Auth Service
        # All requests starting with /api/v1/auth go to auth-service
        - id: auth-service
          uri: ${AUTH_SERVICE_URL:http://localhost:8081}
          predicates:
            - Path=/api/v1/auth/**
        
        # Route: /api/v1/accounts/** → account-service
        - id: account-service
          uri: ${ACCOUNT_SERVICE_URL:http://localhost:8082}
          predicates:
            - Path=/api/v1/accounts/**
        
        # Route: /api/v1/payments/** → payment-service (Stage 2)
        - id: payment-service
          uri: ${PAYMENT_SERVICE_URL:http://localhost:8083}
          predicates:
            - Path=/api/v1/payments/**

        # Route: /api/v1/sessions/** → session-service (Stage 3)
        - id: session-service
          uri: ${SESSION_SERVICE_URL:http://localhost:8086}
          predicates:
            - Path=/api/v1/sessions/**

        # Route: /api/v1/search/** → search-service (Stage 3)
        - id: search-service
          uri: ${SEARCH_SERVICE_URL:http://localhost:8087}
          predicates:
            - Path=/api/v1/search/**

logging:
  level:
    org.springframework.cloud.gateway: DEBUG
    reactor.netty: INFO

# EDUCATIONAL NOTE - How Routing Works
#
# Example request: POST http://localhost:8080/api/v1/auth/register
#
# 1. Gateway receives the request on port 8080
# 2. Checks predicates: Path=/api/v1/auth/** matches!
# 3. Routes to: http://localhost:8081/api/v1/auth/register
# 4. Auth service processes the request
# 5. Response flows back through gateway to client
#
# The client doesn't know (or care) that auth-service is on port 8081.
# They only know the gateway at port 8080.
